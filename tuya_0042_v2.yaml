blueprint:
  name: Tuya TS0042 Multi-Device Scene Switch with 8 Scenes Support
  description: Универсальный blueprint для TS0042 с выбором устройств и до 8 сцен, поддержкой short, double и long press для обеих кнопок.
  domain: automation
  input:
    devices:
      name: Устройства TS0042 (IEEE адреса)
      description: Список IEEE адресов устройств Tuya TS0042 через запятую
      selector:
        text:
          multiline: true
    input_select_entity:
      name: Input Select для выбора сцены
      description: Input_select с перечисленными сценами
      selector:
        entity:
          domain: input_select
    scene_1:
      name: Сцена 1
      selector:
        entity:
          domain: scene
    scene_2:
      name: Сцена 2
      selector:
        entity:
          domain: scene
    scene_3:
      name: Сцена 3
      selector:
        entity:
          domain: scene
    scene_4:
      name: Сцена 4
      selector:
        entity:
          domain: scene
    scene_5:
      name: Сцена 5
      selector:
        entity:
          domain: scene
    scene_6:
      name: Сцена 6
      selector:
        entity:
          domain: scene
    scene_7:
      name: Сцена 7
      selector:
        entity:
          domain: scene
    scene_8:
      name: Сцена 8
      selector:
        entity:
          domain: scene

trigger:
  - platform: event
    event_type: zha_event

condition:
  - condition: template
    value_template: >
      {{ trigger.event.data.device_ieee in [d.strip() for d in (blueprint.devices.split(','))] and
         trigger.event.data.command in ['short', 'double', 'long'] and
         trigger.event.data.endpoint_id in [1,2] }}

action:
  - choose:
      # Левая кнопка (endpoint_id=1)
      - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.endpoint_id == 1 and trigger.event.data.command == 'double' }}"
        sequence:
          - service: input_select.select_next
            target:
              entity_id: !input input_select_entity

      - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.endpoint_id == 1 and trigger.event.data.command == 'short' }}"
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input scene_1

      - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.endpoint_id == 1 and trigger.event.data.command == 'long' }}"
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input scene_8

      # Правая кнопка (endpoint_id=2)
      - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.endpoint_id == 2 and trigger.event.data.command == 'double' }}"
        sequence:
          - service: input_select.select_previous
            target:
              entity_id: !input input_select_entity

      - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.endpoint_id == 2 and trigger.event.data.command == 'short' }}"
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input scene_2

      - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.endpoint_id == 2 and trigger.event.data.command == 'long' }}"
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input scene_7

  - delay: "00:00:01"

  # Обновить input_select после переключения
  - service: input_select.select_option
    
      entity_id: !input input_select_entity
      option: "{{ states(!input input_select_entity).state }}"

